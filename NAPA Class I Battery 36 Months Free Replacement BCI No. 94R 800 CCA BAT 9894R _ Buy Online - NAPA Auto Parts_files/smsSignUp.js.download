$(document).ready(function(){var pageUrl=new URL(window.location);var cid=pageUrl.searchParams.get("cid");function setCookie(cname,cvalue,exdays){const d=new Date();d.setTime(d.getTime()+(exdays*24*60*60*1000));let expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+";"+expires+";path=/";}if($_gmRestrictions!="CA"){function setEmailNameValidation(){$("#firstName").attr("data-parsley-required",true);$("#lastName").attr("data-parsley-required",true);$(".fname-astrek").show();$(".lname-astrek").show();}function removeEmailNameValidation(){$("#firstName").attr("data-parsley-required",false);$("#lastName").attr("data-parsley-required",false);$(".fname-astrek").hide();$(".lname-astrek").hide();}var subscriptionType=pageUrl.searchParams.get("subscribermailId");if(subscriptionType){var isOnlyMessageSubscribe=/^[0-9]*$/g.test(subscriptionType);var isPhone=isOnlyMessageSubscribe,isEmail=!isOnlyMessageSubscribe;var result="Email";if(isOnlyMessageSubscribe){result="Message";}$("#preferred"+result).attr("data-parsley-required",true);$("#preferred"+result).prop("checked",true);if(isOnlyMessageSubscribe){$("#mobileNumber").parent(".pure-control-group").show();$("#mobileNumber").val(formatUsPhoneNumber(subscriptionType));$("#subEmail").parent(".pure-control-group").hide();$("#confEmail").parent(".pure-control-group").hide();$(".sign-up").addClass("smsSubscribeSignUpBtn");$("#subEmail").val("");$("#confEmail").val("");removeEmailNameValidation();}else{$("#mobileNumber").parent(".pure-control-group").hide();$("#subEmail").parent(".pure-control-group").show();$("#confEmail").parent(".pure-control-group").show();$("#subEmail").val(subscriptionType);$("#mobileNumber").val("");$(".sign-up").removeClass("smsSubscribeSignUpBtn");setEmailNameValidation();}}else{setEmailNameValidation();setCommunicationPreference();}$("#preferredEmail").on("click",function(){if($(this).prop("checked")){isEmail=true;setEmailNameValidation();if(!$("#preferredMessage").prop("checked")){isPhone=false;$("#mobileNumber").parent(".pure-control-group").hide();}$("#subEmail").siblings(".error-wrap").children().show();$("#confEmail").siblings(".error-wrap").children().show();$("#subEmail").parent(".pure-control-group").show();$("#confEmail").parent(".pure-control-group").show();if(subscriptionType&&!isOnlyMessageSubscribe){$("#subEmail").val(subscriptionType);}}else{removeEmailNameValidation();isEmail=false;$("#subEmail").parent(".pure-control-group").hide();$("#subEmail").val("");$("#confEmail").val("");$("#confEmail").parent(".pure-control-group").hide();if(!$("#preferredMessage").prop("checked")){setEmailNameValidation();$("#mobileNumber").siblings(".error-wrap").children().show();$("#mobileNumber").parent(".pure-control-group").show();isPhone=false;isEmail=false;$("#subEmail").parent(".pure-control-group").show();$("#confEmail").parent(".pure-control-group").show();}}setCommunicationPreference();validateCommunicationPreference();});$("#preferredMessage").on("click",function(){if($(this).prop("checked")){isPhone=true;if(!$("#preferredEmail").prop("checked")){removeEmailNameValidation();isEmail=false;$("#subEmail").parent(".pure-control-group").hide();$("#confEmail").parent(".pure-control-group").hide();}$("#mobileNumber").siblings(".error-wrap").children().show();$("#mobileNumber").parent(".pure-control-group").show();$(".sign-up").addClass("smsSubscribeSignUpBtn");if(subscriptionType&&isOnlyMessageSubscribe){$("#mobileNumber").val(formatUsPhoneNumber(subscriptionType));}}else{isPhone=false;$("#mobileNumber").parent(".pure-control-group").hide();$("#mobileNumber").val("");$(".sign-up").removeClass("smsSubscribeSignUpBtn");if(!$("#preferredEmail").prop("checked")){setEmailNameValidation();isEmail=false;isPhone=false;$("#mobileNumber").parent(".pure-control-group").show();$("#subEmail").parent(".pure-control-group").show();$("#confEmail").parent(".pure-control-group").show();$("#subEmail").siblings(".error-wrap").children().show();$("#confEmail").siblings(".error-wrap").children().show();}}setCommunicationPreference();validateCommunicationPreference();});var parsleyExcludeObj={excluded:"input[type=button], input[type=submit], input[type=reset], input[type=hidden], [disabled], :hidden"};if($(".email-signup-content #registerForm").length>0){$("#registerForm").parsley(parsleyExcludeObj).on("form:success",function(){}).on("form:error",function(err){});$(".subscribe-cancel-btn").click(function(){$("#registerForm")[0].reset();$(".sms-invalid-format-msg").addClass("hidden-elem");$("#subEmail").is(":visible")?$("#subEmail").val(""):null;return false;});}$(".sign-up").on("click",function(e){setCommunicationPreference();if($("#registerForm").parsley(parsleyExcludeObj).isValid()){if(isPhone&&isEmail){e.preventDefault();smsSignupAjaxCall();return;}if(isPhone){e.preventDefault();!isOnlyMessageSubscribe?smsSignupAjaxCall():null;return;}}});function setCommunicationPreference(){var isEmailchecked=$("#preferredEmail").prop("checked");var isMessagechecked=$("#preferredMessage").prop("checked");if(!isEmailchecked&&!isMessagechecked){$("#preferredEmail").attr("data-parsley-required",true);$("#preferredMessage").attr("data-parsley-required",true);}else{$("#preferredEmail").attr("data-parsley-required",false);$("#preferredMessage").attr("data-parsley-required",false);}}function validateCommunicationPreference(){$("#preferredEmail").parsley().validate();$("#preferredMessage").parsley().validate();}function validateSubscribeForm(){var isValid=$("#registerForm").parsley({excluded:"input[type=button], input[type=submit], input[type=reset], input[type=hidden], [disabled], :hidden"}).validate();}$(".smsSubscribeSignUpBtn").on("click",function(){setCommunicationPreference();if($("#registerForm").parsley(parsleyExcludeObj).isValid()){smsSignupAjaxCall();}});}$(".register-btn").on("click",function(e){$(".register-sms-invalid-format-msg").addClass("hidden-elem");if($("#registerForm").parsley(parsleyExcludeObj).isValid()){if($("#promo-message-agree").prop("checked")){e.preventDefault();smsSignupAjaxCall();}else{$("#registerForm").submit();}}});function smsSignupAjaxCall(){var formFlag=$(".smsSubscribeSignUpBtn").parents("div").find(".smsInput").length>0;var formatedPhoneNum=formFlag?$(".smsSubscribeSignUpBtn").parents("div").find(".smsInput").val():$("#mobileNumber").val();var phoneNum=formatedPhoneNum.replace(/[^0-9]/g,"");var smsSignUpUrl=$(".smsUrl").attr("data-url");var fname=$("#firstName").val();var lname=$("#lastName").val();var smsUrl=smsSignUpUrl+phoneNum+(fname!=""?"&fname="+fname:"")+(lname!=""?"&lname="+lname:"");if(formFlag){var pageName=AAData.page.pageName;var url=window.location.href;try{analytics.smsSignupClick.signupClicksEvent(url,location,pageName);}catch(error){console.log("Analytics Did Not Load smsSignupClick",error);}}$.ajax({url:smsUrl,type:"POST",success:function(results){if(results.status==="PENDING"){try{analytics.smsSignup.smsSignupEvent(url,location,pageName);}catch(error){console.log("Analytics Did Not Load smsSignupClick",error);}if(isEmail||isPhone){$(".sms-invalid-format-msg").addClass("hidden-elem");}if((isEmail&&isPhone)||!formFlag){$("#registerForm").submit();}if(isPhone&&!isEmail){$("#registerForm").hide();$("#subscribe-confirm").show();$(".email-success").addClass("hidden-elem");$(".email-phone-success").addClass("hidden-elem");$(".phone-success").removeClass("hidden-elem");$("#subscribe-confirm").find(".submitted-phoneNo").html(formatedPhoneNum);}if($("#promo-message-agree").prop("checked")){try{if(_satellite){_satellite.track("SMS_Email_Signup");}}catch(e){}}if(isPhone){try{if(_satellite){_satellite.track("SMS_Email_Subscribe");}}catch(e){}}}},error:function(err){if(isPhone){$("#registerForm").show();$(".email-success").addClass("hidden-elem");$(".email-phone-success").addClass("hidden-elem");$(".phone-success").addClass("hidden-elem");$("#subscribe-confirm").hide();}if((isEmail&&isPhone)||!formFlag){$("#registerForm").submit();}}});}$(".smsInput").on("keyup paste",function(e){var key=e.which;if(key==13){$(".smsSignUpBtn").click();}var input=this.value.replace(/[^0-9\(\)\s\-]/g,"");var inputlen=input.length;var numbers=this.value.replace(/\D/g,"");var numberslen=numbers.length;var newval="";for(var i=0;i<numberslen;i++){if(i==0){newval="("+numbers[i];}else{if(i==3){newval+=") "+numbers[i];}else{if(i==6){newval+="-"+numbers[i];}else{newval+=numbers[i];}}}}if(inputlen>=1&&numberslen==0&&input[0]=="("){newval="(";}else{if(inputlen>=6&&numberslen==3&&input[4]==")"&&input[5]==" "){newval+=") ";}else{if(inputlen>=5&&numberslen==3&&input[4]==")"){newval+=")";}else{if(inputlen>=6&&numberslen==3&&input[5]==" "){newval+=" ";}else{if(inputlen>=10&&numberslen==6&&input[9]=="-"){newval+="-";}}}}}$(this).val(newval.substring(0,14));});if(document.cookie.indexOf("smsPopupClosed")>-1||document.cookie.indexOf("smsSession")>-1){$(".fixed-wrapper").removeClass("addTop");$(".smsSignUpContainer").remove();}else{$(".smsSignUpContainer").slideDown("slow");$(".fixed-wrapper").addClass("addTop");}$(document).on("click",".noThanks , .closePromo",function(){try{$(this).prev().closest(".smsSignUpContainer").slideUp("slow");$(".fixed-wrapper").removeClass("addTop");$(".fixed-header").removeClass("sms-top");var exDate=$(".closePromo").attr("exp-attr");var smsCookie=new Date;smsCookie.setTime(smsCookie.getTime()+(parseInt(exDate)*24*60*60*1000));document.cookie="smsPopupClosed=yes; path=/; expires="+smsCookie.toGMTString()+",Secure;SameSite=Strict";}catch(err){console.log(err);}});$(".smsSignUpBtn").on("click",function(){var phoneNum=$(this).prev().closest(".smsInput").val().replace(/[^0-9]/g,"");var smsSignUpUrl=$(".smsUrl").attr("data-url");var smsUrl=smsSignUpUrl+phoneNum;if($(this).hasClass("topBanner")){var location="header overlay";var banner="top";}else{var location="banner";var banner="bot";}var pageName=AAData.page.pageName;var url=window.location.href;try{analytics.smsSignupClick.signupClicksEvent(url,location,pageName);}catch(error){console.log("Analytics Did Not Load smsSignupClick",error);}$.ajax({url:smsUrl,type:"POST",success:function(results){if(results.status==="PENDING"){$(".noThanks").removeClass("anotherPhone");if(banner==="top"||$(".smsSignUpBtn").length===1){$(".smsSignUp").eq(0).hide();$(".smsSucess").eq(0).show();$(".smsInput").eq(0).parent().removeClass("smsErrorMsg");$(".smsErr").eq(0).addClass("hidden-elem");}if(banner==="bot"){$(".smsSignUp").eq(1).hide();$(".smsSucess").eq(1).show();$(".smsInput").eq(1).parent().removeClass("smsErrorMsg");$(".smsErr").eq(1).addClass("hidden-elem");}try{analytics.smsSignup.smsSignupEvent(url,location,pageName);}catch(error){console.log("Analytics Did Not Load smsSignupClick",error);}$(".smsInput").removeClass("smsError");setTimeout(function(){if(!$(".noThanks").hasClass("anotherPhone")){$(".noThanks").click();}},10000);}},error:function(err){if(err.status===422||err.status===400){if(banner==="top"||$(".smsSignUpBtn").length===1){$(".smsInput").eq(0).addClass("smsError");$(".smsInput").eq(0).parent().addClass("smsErrorMsg");$(".smsErr").eq(0).removeClass("hidden-elem");}if(banner==="bot"){$(".smsInput").eq(1).addClass("smsError");$(".smsInput").eq(1).parent().addClass("smsErrorMsg");$(".smsErr").eq(1).removeClass("hidden-elem");}}if(err.status===409){if(banner==="top"||$(".smsSignUpBtn").length===1){$(".smsSignUp").eq(0).hide();$(".smsSucess").eq(0).show();$(".smsInput").eq(0).parent().removeClass("smsErrorMsg");$(".smsErr").eq(0).addClass("hidden-elem");}if(banner==="bot"){$(".smsSignUp").eq(1).hide();$(".smsSucess").eq(1).show();$(".smsInput").eq(1).parent().removeClass("smsErrorMsg");$(".smsErr").eq(1).addClass("hidden-elem");}setTimeout(function(){if(!$(".noThanks").hasClass("anotherPhone")){$(".noThanks").click();}},10000);}}});});$(".subsribeMsg").on("click",function(){$(".noThanks").addClass("anotherPhone");$(".smsInput").val("");$(".smsSignUp").show();$(".smsSucess").hide();});$(".smsSignUpLandingPage").on("click",function(){var phoneNum=$(this).parent().parent().find(".smsInput").val().replace(/[^0-9]/g,"");var firstName=$(this).parent().parent().find(".smsFistName").val();var lastName=$(this).parent().parent().find(".smsLastName").val();var zipCode=$(this).parent().parent().find(".smsZipCode").val();var smsSignUpUrl=$(".smsUrl").attr("data-url");var smsUrl=smsSignUpUrl+phoneNum+"&fname="+firstName+"&lname="+lastName+"&zip="+zipCode;var location="landing-page";var pageName=AAData.page.pageName;var url=window.location.href;try{analytics.smsSignupClick.signupClicksEvent(url,location,pageName);}catch(error){console.log("Analytics Did Not Load smsSignupClick",error);}$.ajax({url:smsUrl,type:"POST",success:function(results){if(results.status==="PENDING"){$(".smsInput").removeClass("smsError");$(".smsLandingSuccessMsg").removeClass("hidden-elem");$(".smsLandingErrorMsg").addClass("hidden-elem");try{analytics.smsSignup.smsSignupEvent(url,location,pageName);}catch(error){console.log("Analytics Did Not Load smsSignupClick",error);}$(".smsInput").attr("aria-invalid","false");}},error:function(err){if(err.status===422||err.status===400){$(".smsInput").addClass("smsError");$(".smsLandingErrorMsg").removeClass("hidden-elem");$(".smsLandingSuccessMsg").addClass("hidden-elem");$(".smsInput").attr("aria-invalid","true");}if(err.status===409){$(".smsInput").removeClass("smsError");$(".smsLandingSuccessMsg").removeClass("hidden-elem");$(".smsLandingErrorMsg").addClass("hidden-elem");$(".smsInput").attr("aria-invalid","true");}}});});$(".smsSignUpBtnMobile").on("click",function(){if($(this).hasClass("topBanner")){var location="header overlay";}else{var location="banner";}var pageName=AAData.page.pageName;var url=window.location.href;try{analytics.smsSignupClick.signupClicksEvent(url,location,pageName);}catch(error){console.log("Analytics Did Not Load smsSignupClick",error);}});function subscribeSMS(mobileNo,orderNO){var subscriptionStatus="Error";var url=NAPA.config.encodedContextPath+"/checkout/multi/orderSummary/subscribeSMS?mobileNo="+mobileNo+"&orderNo="+orderNO;$.ajax({type:"GET",url:url,timeout:NAPA.config.globalAjaxTimeout,success:function(result){var idSelected=$("input[name=isSmsOpted]:checked").val();var smsorderupdate=$(".smsOrderUpdate").attr("data-SmsOptedSuccessfull");if(!idSelected||(idSelected&&smsorderupdate==="false")){try{analytics.smsTrackClick.smsTrackClickEvent();}catch(error){console.log("Analytics Did Not Load smsSignupClick",error);}}if(result.statusCode==="200"||result.statusCode==="409"){$(".smsOrderSuccessMsg").removeClass("hidden-elem");$(".smsOrderErrorMsg").addClass("hidden-elem");$(".smsInput").attr("aria-invalid","false");try{analytics.smsTrackClickSuccess.smsTrackClickSuccessEvent();}catch(error){console.log("Analytics Did Not Load smsSignupClick",error);}}if(result.statusCode==="422"||result.statusCode==="400"){$(".smsInput").addClass("smsError");$(".smsOrderErrorMsg").removeClass("hidden-elem");$(".smsOrderSuccessMsg").addClass("hidden-elem");$(".smsInput").attr("aria-invalid","true");}},error:function(err){console.log(err);}});}$(".smsOrderUpdate").on("click",function(){var phoneNumb=$("#subscriptionMobile").val().replace(/[^0-9]/g,"");var orderNum=$(".smsHeader").attr("att-orderCode");subscribeSMS(phoneNumb,orderNum);});$("#subscriptionMobile").on("keyup paste",function(e){var key=e.which;if(key==13){$(".smsOrderUpdate").click();}var input=this.value.replace(/[^0-9\(\)\s\-]/g,"");var inputlen=input.length;var numbers=this.value.replace(/\D/g,"");var numberslen=numbers.length;var newval="";for(var i=0;i<numberslen;i++){if(i==0){newval="("+numbers[i];}else{if(i==3){newval+=") "+numbers[i];}else{if(i==6){newval+="-"+numbers[i];}else{newval+=numbers[i];}}}}if(inputlen>=1&&numberslen==0&&input[0]=="("){newval="(";}else{if(inputlen>=6&&numberslen==3&&input[4]==")"&&input[5]==" "){newval+=") ";}else{if(inputlen>=5&&numberslen==3&&input[4]==")"){newval+=")";}else{if(inputlen>=6&&numberslen==3&&input[5]==" "){newval+=" ";}else{if(inputlen>=10&&numberslen==6&&input[9]=="-"){newval+="-";}}}}}$(this).val(newval.substring(0,14));});$("#submitBtnSms").on("click",function(){var phoneNum=$("#phone").val().replace(/[^0-9]/g,"");var isReceiveOrderUpdate=$("#isReceiveOrderUpdate:checked").val();var isSMSPromotion=$("#isSMSPromotion:checked").val();var path=$("#smsUrl").val();var orderId=$("#orderId").val();var smsUrl=window.location.origin+path+"?phoneNumber="+phoneNum+(isReceiveOrderUpdate?"&isReceiveOrderUpdate="+true:"&isReceiveOrderUpdate="+false)+(isSMSPromotion?"&isSMSPromotion="+true:"&isSMSPromotion="+false)+(orderId?"&orderNo="+orderId:"");if(phoneNum!=""){$.ajax({url:smsUrl,type:"GET",success:function(results){if(results.sthOrderSubscriptionSuccess==true||results.smsPromotionSubscriptionSuccess==true){$(".smsOrderSuccessMsg").removeClass("hidden-elem");}if(results.error==true){$(".smsOrderErrorMsg").removeClass("hidden-elem");}},error:function(err){console.log("error",err);}});}});});