var infowindow;ACC.storefinder={map:"",bindAll:function(){this.drawMap();this.getStoreMarkersImages();this.bindFindStoresNearMe();},drawMap:function(mapCanvasId){if(mapCanvasId!="undefined"&&mapCanvasId!=""){var mapCanvas=mapCanvasId;}else{var mapCanvas="map_canvas";}if($("#"+mapCanvas).length!=0){var $e=$("#"+mapCanvas);var centerPoint=new google.maps.LatLng($e.data("latitude"),$e.data("longitude"));var mapOptions={zoom:13,zoomControl:true,panControl:true,streetViewControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,center:centerPoint};ACC.storefinder.map=new google.maps.Map(document.getElementById(mapCanvas),mapOptions);if($e.data("southLatitude")){this.setMapBouns(mapCanvas);this.getStorePosition(mapCanvas);}else{store=$e.data("stores");this.addStore(store.id,store.latitude,store.longitude,store.name,store.url,store.address,store.facilityId);}google.maps.event.addListenerOnce(ACC.storefinder.map,"tilesloaded",function(){setTimeout(function(){$("#"+mapCanvas).find("[tabindex]").not("[aria-label]").attr("aria-label","Google Map section");$("#"+mapCanvas).find('iframe[aria-hidden="true"]').attr("tabindex","-1");},100);});}initAutocomplete();},setMapBouns:function(mapCanvasId){var $e=$("#"+mapCanvasId);var swBounds=new google.maps.LatLng($e.data("southLatitude"),$e.data("westLongitude"));var neBounds=new google.maps.LatLng($e.data("northLatitude"),$e.data("eastLongitude"));var bounds=new google.maps.LatLngBounds(swBounds,neBounds);ACC.storefinder.map.fitBounds(bounds);},getStorePosition:function(mapCanvasId){var $e=$("#"+mapCanvasId);stores=$e.data("stores");$.each(stores,function(k,v){ACC.storefinder.addStore(v.id,v.latitude,v.longitude,v.name,v.url,v.address,v.facilityId);});},addStore:function(i,latitude,longitude,name,url,address,facilityId){var index=++i;markerTitle=name.concat(address).replace(new RegExp("<br/>","g"),"\n").replace(new RegExp("&nbsp;","g")," ");var marker=new google.maps.Marker({position:new google.maps.LatLng(latitude,longitude),map:ACC.storefinder.map,title:markerTitle,icon:generateMarkerIcon(index)});google.maps.event.addListener(marker,"click",function(){if(infowindow){infowindow.close();}infowindow=new google.maps.InfoWindow({content:'<div style="overflow: hidden;"><a href='+url+' style="font-weight:bold"  class="aadata-mappopup" data-aadata-storeid="'+facilityId+'" data-aadata-storeposition="'+index+'" data-aadata-store-click="Click through store page from map">'+name+"</a>"+address+'<br/><a href="#"  class="blue getDirectionsLink aadata-mappopup" style="font-weight:bold" data-facilityId="'+facilityId+'"  data-aadata-storeid="'+facilityId+'" data-aadata-storeposition="'+index+'" data-aadata-store-click="Get Directions from map">Get Directions </a></div>',disableAutoPan:true});infowindow.open(ACC.storefinder.map,marker);});},getStoreMarkersImages:function(){if($(".storeResultList").length!=0){$(".storeMarker").each(function(i){$(this).attr("src","http://maps.google.com/mapfiles/marker"+"ABCDE".charAt(i)+".png");});}},bindFindStoresNearMe:function(){$(document).on("click","#findStoresNearMe",function(e){e.preventDefault();var gps=navigator.geolocation;if(gps){gps.getCurrentPosition(ACC.storefinder.positionSuccessStoresNearMe,function(error){console.log("An error occurred... The error code and message are: "+error.code+"/"+error.message);});}});},positionSuccessStoresNearMe:function(position){$("#latitude").val(position.coords.latitude);$("#longitude").val(position.coords.longitude);$("#nearMeStorefinderForm").submit();return false;}};$(document).ready(function(){ACC.storefinder.bindAll();});

function generateMarkerIcon(index, fillColor, textColor){
    try {
        fillColor = fillColor || "#0D2A8A";
        textColor = textColor || "#FFFFFF";
        if(fillColor && fillColor.indexOf('#') == -1) fillColor = '#' + fillColor;
        if(textColor && textColor.indexOf('#') == -1) textColor = '#' + textColor;
        const svg = 
            '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="32" viewBox="0 0 24 36">' +
                '<path d="M12 0C5.37 0 0 5.37 0 12c0 7.5 12 24 12 24s12-16.5 12-24c0-6.63-5.37-12-12-12z" fill="' + fillColor + '"/>' +
                '<text x="12" y="16" text-anchor="middle" font-size="12" fill="' + textColor + '" font-family="Arial, sans-serif" font-weight="bold" dy=".3em">' + index + '</text>' +
            '</svg>';
        return "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(svg);
    } catch (error) {
        return "";
    }
}